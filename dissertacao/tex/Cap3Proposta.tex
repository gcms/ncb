
\chapter{Construção dirigida por modelos de máquinas virtuais específicas de domínio}
\label{cap:abordagem}

Este capítulo descreve a abordagem proposta por este trabalho para a construção dirigida por modelos de máquinas virtuais capazes de executar aplicações descritas através de modelos de alto nível. A seção ~\ref{sec:visao-geral-2} descreve de forma geral a abordagem proposta e o cenário onde ela se posiciona. A seção ~\ref{sec:sb}, por sua vez, detalha parte do escopo da abordagem proposta.

%Retomar a motivação introduzida no primeiro capítulo com mais detalhes (i.e. voltar nos precedentes e descrever melhor o cenário onde o problema a ser tratado se localiza)

%Elaborar um argumento sobre a proposta geral de possibilitar a modelagem da máquina virtual, ou seja dos aspectos comportamentais.

%Descrever bem o objetivo específico, ou seja, o meta-modelo para NCB e os aspectos que serão tratado nesse meta-modelo.



\section{Visão geral}
\label{sec:visao-geral-2}

%O desenvolvimento de aplicações que utilizam uma variedade de recursos heterogêneos para prover uma funcionalidade única ao usuário (ler tese Andrew, parte 3 ou papers CVM) é muito trabalhoso.

Aplicações que integram diversos recursos com o intuito de prover uma funcionalidade de alto nível de forma transparente ao usuário precisam ser capazes de tratar adequadamente a seleção, configuração, adaptação e gerenciamento dos recursos disponíveis. O desenvolvimento deste tipo de aplicação, utilizando abordagens tradicionais de programação exige a codificação (em linguagem de propósito geral) do comportamento desejado para todos estes aspectos, além dos requisitos específicos do domínio de negócio da aplicação.
% aspectos não diretamente relacionados ao domínio e o uso de linguagem de baixo-nível resultam em complexidade para traduzir os requisitos em código


%O emprego de técnicas de MDE (criação de transformadores ou interpretadores capazes de processar uma linguagem de domínio específico) permite especificar um serviço de alto nível a partir de seus requisitos, e realizá-los automaticamente. Como exemplo temos a CVM.

O emprego de técnicas de MDE possibilita reduzir significativamente a complexidade envolvida na construção de aplicações com estas características. A concepção de uma linguagem de modelagem específica de domínio e mecanismos capazes de processá-la possibilita que aplicações dentro de um dado domínio sejam descritas a partir de modelos de alto nível baseados em conceitos próprios do domínio em questão.

%Isto só é possível, pois estamos tratando de um domínio específico (comunicação), e portanto o conhecimento deste domínio está incorporado à linguagem (CML) [procurar referencia] e à plataforma responsável por sua realização (CVM) [procurar referencia].

Para tornar isto possível, o conhecimento do domínio é incorporado à linguagem e aos mecanismos responsáveis pelo seu processamento, tornando desnecessária a descrição desse conhecimento durante a concepção de um modelo que represente uma determinada aplicação.
% referencia!!
A CML, como um exemplo de linguagem de modelagem específica do domínio de comunicação, incorpora em seu projeto elementos diretamente relacionados à descrição de cenários de comunicação entre pessoas. A CVM por sua vez é a plataforma capaz de processar esta linguagem e, para isso, também precisa incorporar todas as operações envolvidas na realização de um serviço de comunicação já apresentadas.

Assim sendo, a aplicação dessa abordagem ao domínio de comunicação permite a descrição dos requisitos e estrutura de uma comunicação através de construções relativas a este domínio. No entanto, o comportamento envolvido na realização do serviço, incorporado à plataforma, ainda é codificado em uma linguagem de propósito geral.
%referencia
Logo, ajustar ou evoluir esse comportamento para atender novos cenários ou necessidades exige um grande esforço de codificação.

% Dúvida: Escrever o mesmo parágrafo acima de forma independente da CVM?
% Dúvida: Explicar melhor que a descrição do mecanismo de processamento (interpretado ou compilado ou transformação ou etc) é geralmente feito em linguagem de programação de propósito geral e/ou linguagens de transformação genéricas. Referencia: Model Transformation: The Heart and Soul of Model-Driven Software Development

Neste trabalho, propomos que esse comportamento também seja definido através de modelos, de forma a reduzir a complexidade envolvida em sua especificação e manipulação.
Desta forma, o comportamento envolvido no processamento de um modelo na linguagem específica de domínio que se encontrava incorporado ao código da plataforma passa a ser descrito a partir de um modelo. 
% Dúvida: Não sei se coloco aqui que "assim modelamos tanto a estrutura e o comportamento, de forma que nenhum deles precisa ser descrito através de código" ou deixo isso pra uma outra parte porque isso está associado ao fato que o conhecimento específico do domínio está incorporado na plataforma de na linguagem
% Dúvida: Talvez falte uma frase aqui falando sobre a equivalencia entre o modelo comportamental e a descrição da máquina virtual
Portanto, a abordagem dirigida por modelos é aplicada não só à descrição de aplicações, mas também à descrição de plataformas projetadas para executá-las. 

Ao fazê-lo, buscamos uma abordagem dirigida por modelos para a construção de plataformas para definição e execução de aplicações descritas através de modelos específicos de um determinado domínio de negócio. Esta abordagem visa a descrição de plataformas como a CVM, capazes de fornecer um serviço de alto nível descrito através de um modelo centrado no usuário a partir de um conjunto heterogêneo de recursos.
%, e que se baseiam no fornecimento de um serviço a partir de um conjunto de heterogêneo de recursos.
% Tornar mais específico, i.e. dizer que é para disponibilizar serviços baseado em recursos heterogêneos (como na CVM)
% TODO: Foco em máquinas virtuais no domínio específico

Uma linguagem, como a CML, tem como principal elemento a sua sintaxe abstrata que é comumente descrita através de um meta-modelo. Isto possibilita que a CML seja modificada através da manipulação do seu meta-modelo, que também é um modelo.
Ao se integrar o meta-modelo de uma linguagem específica de domínio à um modelo que descreve uma máquina virtual capaz de executá-la temos uma linguagem e plataforma para desenvolvimento de aplicações em um determinado domínio que podem ser ajustados e evoluídos através da manipulação de modelos.

No entanto, para que seja vantajoso o emprego de uma linguagem de modelagem para a descrição de uma máquina virtual esta linguagem deve possuir uma abrangência suficiente para que possa ser utilizada em diferentes domínios de negócio. Ao mesmo tempo, tal linguagem não deve ser muito genérica, de forma que não torne a manipulação de modelos tão complexa quanto a codificação em uma linguagem de propósito geral.

Considerando isto, essa linguagem deve conter construções capazes de descrever os aspectos comportamentais que independem do domínio de negócio e que estão envolvidos no fornecimento de serviços de alto nível descritos a partir de modelos construídos diretamente pelo usuário.
Esses aspectos, que englobam tarefas como transformações de modelos, negociação de configurações apropriadas, monitoramento do ambiente, seleção e configuração de recursos, entre outros, podem ser tratados como um domínio técnico. Deste modo, tal linguagem pode ser considerada uma linguagem específica de um domínio que abrange os aspectos técnicos envolvidos na realização de serviços transparentes de alto nível a partir de um conjunto heterogêneo de recursos.
% procurar referencia que linguagem precisa ser de domínio específico para se tornar realizável
% e domíno técnico também

Tendo em vista estas necessidades, propomos uma arquitetura genérica para a definição dessa categoria de máquinas virtuais dirigidas por modelos centrados no usuário.
% baseado na experiencia obtida na CVM (ver uma boa forma de dizer isso)
Assim como a CVM, tal arquitetura também se baseia em camadas com responsabilidades bem definidas. 
Na abordagem proposta, as camadas desta arquitetura são definidas através de modelos cujas construções estão relacionadas às responsabilidades relativas à cada camada. A Figura \ref{fig:uvm} ilustra esta arquitetura de Máquinas Virtuais centradas no Usuário (\emph{User-centric Virtual Machine} - UVM) onde temos as seguintes camadas:

%\begin{comment}
%A nomenclatura é simplesmente uma mudança da nomenclatura da CVM removendo o termo "Communication".
%Algumas coisas não fazem muito sentido como uma camada de Middleware Centrado no Usuário para uma arquitetura que não é necessariamente voltada para sistemas distribuídos. Aliás, na própria CVM isso é confuso pois a CVM como um todo pode ser enxergada como uma plataforma de middleware, mas tem dentro dela uma camada de Middleware centrado no usuário. Além disso, a própria NCB também não pode ser enxergada como um middleware de comunicação?
%\end{comment}


\begin{itemize}

\item  Interface com o Usuário (\emph{User Interface} - UI), que provê uma interface externa para utilização da plataforma. Além disso, esta camada possibilita a definição e gerenciamento de modelos;

\item Mecanismo de Síntese (\emph{Synthesis Engine} - SE), que possui como principal responsabilidade a transformação de um modelo declarativo fornecido pela UI em uma representação algorítmica a ser executada pela camada inferior;

\item \emph{Middleware} Centrado no Usuário (\emph{User-centric middleware} - UM), que além de executar as requisições geradas pelo Mecanismo de Síntese,  também gerencia os serviços providos pela máquina virtual e as tarefas em execução. Essa também é a camada responsável pela aplicação de restrições de segurança, qualidade de serviço, entre outras específicas do domínio de negócio. 

\item Intermediador de Serviço (\emph{Service Broker} - SB), que é a camada responsável pelo gerenciamento dos recursos. Assim sendo, essa camada tem como objetivo prover uma interface de acesso aos recursos de forma independente da tecnologia empregada por estes, provendo um serviço transparente à camada UM.

\end{itemize}

\begin{figure}
 \centering
 \includegraphics[width=0.40\textwidth]{./fig/uvm}
 \caption{Arquitetura proposta para esta categoria de Máquinas Virtuais centradas no Usuário.}
 \label{fig:uvm}
\end{figure}

Ao imitar a arquitetura da CVM, nos aproveitamos do conhecimento adquirido em relação à separação de responsabilidades necessárias para a realização de serviços no domínio técnico identificado. No entanto, apesar de apresentar a mesma estrutura, a arquitetura proposta se difere por ser independente do domínio de negócio.
Além disso, na abordagem proposta, cada camada é descrita através de um modelo. Este modelo, por sua vez, é construído em conformidade com um meta-modelo da camada que contém elementos associados às responsabilidades da camada.
%Estamos instanciando uma máquina virtual 
Assim sendo, a abordagem dirigida por modelos é empregada para a definição e manipulação de cada camada da plataforma.


\section{Abordagem dirigida por modelos para definição do Intermediador de Serviço}
\label{sec:sb}

% EM ALGUM LUGAR DESSA SEÇÃO: Definir o que é um recurso

O Intermediador de Serviço é a camada da arquitetura proposta que é responsável pelo gerenciamento dos recursos que serão efetivamente utilizados para prover o serviço solicitado. Cabe à esta camada disponibilizar uma interface de serviços que abstraia as especificidades dos recursos gerenciados para a camada superior. Além disso, o SB deve possuir capacidade de auto gerenciamento, ocultando os detalhes envolvidos na seleção, monitoramento e preparação dos recursos sob sua gerência.

Como uma interface de serviços, o SB se comunica com o UM através de chamadas que podem ser invocadas e eventos que podem ser gerados sinalizando alguma situação. Assim sendo, ao definirmos o comportamento dessa camada, precisamos descrever como serão tratadas as chamadas realizadas pela camada superior, e em que situações serão gerados determinados eventos. Mas além disso, também precisamos descrever como outras tarefas serão realizadas, incluindo o monitoramento e seleção de recursos, manutenção de informações, adaptação da camada, entre outros.

Com isto em mente, neste trabalho, construímos um meta-modelo que possibilita a modelagem do comportamento necessário para atender as responsabilidades definidas para a camada de intermediação de serviço da arquitetura proposta. O meta-modelo em questão contempla a descrição dos seguintes  aspectos envolvidos no cumprimento destas responsabilidades:

%\begin{comment}
%A idéia é que cada uma destas responsabilidades seja brevemente explicada nestes tópicos abaixo. No capítulo seguinte que descreve o meta-modelo eles serão detalhados.
%\end{comment}

\begin{itemize}

\item Tratamento de chamadas e eventos.

\item Gerenciamento de recursos

\item Gerenciamento de estado

\item Computação autonômica

\item Políticas

\end{itemize}

Além do meta-modelo, também construímos um ambiente de execução para auxiliar na execução de suas instâncias. Assim sendo,  esse ambiente implementa a semântica operacional da linguagem para descrição da camada de intermediação de serviço. O ambiente de execução possibilita que um modelo definido a partir do meta-modelo proposto seja executado. 
% mencionar também da semântica estática

Desta forma, o meta-modelo e o ambiente de execução construídos permitem que a camada de intermediação de serviço da arquitetura proposta seja definida através de um modelo baseado em construções relacionadas às suas responsabilidades, e possa ser executada e utilizada.

%O Broker de serviços é responsável por ...
%Assim sendo, ele recebe chamadas da camada de middleware, e executa em diferentes provedores ou retorna eventos. Também monitora os recursos, o que pode gerar adaptações, ou eventos, etc...

%Se aplicarmos os conceitos da proposta a esta camada, temos que: a linguagem processada pela camada é a sua interface exposta à camada Middleware. Ou seja, um modelo descrito nessa linguagem é uma sequencia de chamadas à interface da camada SB.
%(outras considerações relacionadas a aplicação da abordagem a uma parte restrita, lembrar que a linguagem não é complexa e que não é descrita a partir de um meta-modelo pois não será utilizada diretamente pelo usuário, mas pela camada superior, que também será definida em conformidade com um outro futuro meta-modelo comportamental)

%Assim sendo, para definirmos o comportamento através de modelos, precisamos de uma linguagem que possibilite descrever como serão tratadas as chamadas realizadas pela camada Middleware. Mas além disso, para definir o comportamento, precisamos descrever como serão monitorados os recursos, e como e quando serão realizadas adaptações na organização interna da camada.

%Portanto, neste trabalho construímos um meta-modelo que permite descrever os seguintes aspectos necessários a realização das responsabilidades da camada SB: x, y, z
%Além disso,t ambém construímos um ambiente de execução que possibilita execução deste modelo.
%Desta forma:
%   - meta-modelo define a sintaxe-abstrata e semantica estatica
%   - ambiente de execução dá a semântica dinâmica (operacional)

%A partir do ambiente de execução e uma instância do meta-modelo obtemos uma camada de SB para um determinado domínio.